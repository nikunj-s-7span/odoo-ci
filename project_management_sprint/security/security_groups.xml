<odoo noupdate="1">
	<record id="group_project_manager_user" model="res.groups">
        <field name="name">Project Manager</field>
        <field name="category_id" ref="base.module_category_services_project"/>
        <field name="implied_ids" eval="[(4, ref('project.group_project_manager'))]"/>
    </record>

    <record id="group_unrestricted_admin" model="res.groups">
        <field name="name">Access All Projects and tasks</field>
        <field name="category_id" ref="base.module_category_hidden"/>
    </record>
    <record id="project.project_public_members_rule" model="ir.rule">
        <field name="active" eval="False"/>
    </record>
    <record id="project.project_project_manager_rule" model="ir.rule">
        <field name="groups" eval="[(6, 0, [ref('group_unrestricted_admin')])]"/>
    </record>
    <record id="project_project_rule_assigned_user" model="ir.rule">
        <field name="name">Assigned Project Records</field>
        <field name="model_id" ref="project.model_project_project"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('group_project_manager_user')),(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>
    <record id="project_task_rule_assigned_user" model="ir.rule">
        <field name="name">Assigned Project Task Records</field>
        <field name="model_id" ref="project.model_project_task"/>
        <field name="domain_force">['|',('project_id.user_id','=',user.id),('user_ids', 'in', user.ids)]</field>
        <field name="groups" eval="[(4, ref('group_project_manager_user')),(4, ref('base.group_user'))]"/>
        <field name="perm_read" eval="1"/>
        <field name="perm_write" eval="0"/>
        <field name="perm_create" eval="0"/>
        <field name="perm_unlink" eval="0"/>
    </record>
    <record id="project.task_visibility_rule" model="ir.rule">
        <field name="active" eval="False"/>
    </record>
    <record id="project.task_visibility_rule_project_user" model="ir.rule">
        <field name="active" eval="False"/>
    </record>
    <record id="project.ir_rule_private_task" model="ir.rule">
        <field name="active" eval="False"/>
    </record>
    <record id="project.project_manager_all_project_tasks_rule" model="ir.rule">
        <field name="groups" eval="[(6, 0, [ref('group_unrestricted_admin')])]"/>
    </record>

    <!-- Create a rule for unrestricted admin group to see all tasks -->
    <record id="task_analysis_unrestricted_admin_rule" model="ir.rule">
        <field name="name">Tasks Analysis: Unrestricted admin access</field>
        <field name="model_id" ref="project.model_report_project_task_user"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('project_management_sprint.group_unrestricted_admin'))]"/>
    </record>

    <!-- Modify the default manager rule to be inactive -->
    <record id="project.report_project_task_manager_rule" model="ir.rule">
        <field name="active" eval="False"/>
    </record>

    <!-- Modify the default user rule to apply to all users, including managers -->
    <record id="project.report_project_task_user_rule" model="ir.rule">
        <field name="domain_force">[
        '|',
            ('project_id.privacy_visibility', '!=', 'followers'),
            '|',
                ('project_id.message_partner_ids', 'in', [user.partner_id.id]),
                '|',
                    ('task_id.message_partner_ids', 'in', [user.partner_id.id]),
                    ('user_ids', 'in', user.id),
        ]</field>
        <field name="groups" eval="[(4,ref('project.group_project_user')),(4,ref('project.group_project_manager'))]"/>
    </record>
</odoo>
